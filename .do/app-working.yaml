# Working App Platform Configuration - Simplified Single Service
name: performance-dashboard

services:
  # Single combined service (easier to debug)
  - name: app
    source_dir: /
    github:
      repo: syatt-io/performance-dashboard
      branch: main
      deploy_on_push: true
    build_command: npm ci && npm run build && npm run build:frontend
    run_command: npm run start
    environment_slug: node-js
    instance_count: 1
    instance_size_slug: basic-xs  # Slightly larger for combined workload
    http_port: 3000
    routes:
      - path: /
    envs:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: "3000"
      - key: DATABASE_URL
        type: SECRET
        value: ${db.DATABASE_URL}
      - key: ENCRYPTION_KEY
        type: SECRET
        value: 6bebec8bf8714f3482b1ce061e4152c3
      - key: ALLOWED_ORIGINS
        value: ${_self.PUBLIC_URL}
      # Don't use Redis for now to avoid connection issues
      # - key: REDIS_URL
      #   type: SECRET
      #   value: ${redis.REDIS_URL}

# Managed Database
databases:
  - name: db
    engine: PG
    version: "15"
    size: basic
    num_nodes: 1

# Remove Redis for now to simplify debugging
# services:
#   - name: redis
#     image:
#       registry_type: DOCKER_HUB
#       repository: redis
#       tag: "7-alpine"
#     instance_count: 1
#     instance_size_slug: basic-xxs
#     http_port: 6379