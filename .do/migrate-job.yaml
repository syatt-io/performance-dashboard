spec:
  name: performance-dashboard
  databases:
  - engine: PG
    name: db
    num_nodes: 1
    size: basic
    version: "15"
  jobs:
  - name: migrate-db
    source_dir: /
    environment_slug: node-js
    run_command: npx prisma migrate deploy
    envs:
    - key: DATABASE_URL
      scope: RUN_TIME
      type: SECRET
      value: ${db.DATABASE_URL}
  services:
  - name: app
    source_dir: /
    environment_slug: node-js
    build_command: npm ci && npm run build && npm run build:frontend
    run_command: npm run start
    envs:
    - key: NODE_ENV
      scope: RUN_AND_BUILD_TIME
      value: production
    - key: PORT
      scope: RUN_AND_BUILD_TIME
      value: "3000"
    - key: DATABASE_URL
      scope: RUN_AND_BUILD_TIME
      type: SECRET
      value: ${db.DATABASE_URL}
    - key: ENCRYPTION_KEY
      scope: RUN_AND_BUILD_TIME
      value: 6bebec8bf8714f3482b1ce061e4152c3
    - key: ALLOWED_ORIGINS
      scope: RUN_AND_BUILD_TIME
      value: https://performance-dashboard-p7pf5.ondigitalocean.app